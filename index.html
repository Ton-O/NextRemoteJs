<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Next remote</title>
	</head>
	<body>
		<h1>Next remote</h1>
		<br/>
		<br/>
		<p id="stbStatus"></p>
		
		<button id="Power" onCLick="powerKey()">Power</button>
		<button id="Escape" onCLick="escapeKey()">Back/Escape</button>
		<br/>
		<br/>
		<b>Click on channelbutton to switch to channel</b>
		<br/>
		<div id="stationsList" />
		
		<script>
			// Get channels
			fetch('/api/stations')
				.then(function(response) {
					return response.json();
				})
				.then(function(stations) {
					for (let s = 0; s < 10; s++) {
						let stationBtn = document.createElement('button');
						stationBtn.setAttribute('style', 'width: 100px; height: 100px; padding: 5px; background: url(' + stations[s].images[3].url + ') no-repeat; background-size: 100%;');
						stationBtn.id = stations[s].serviceId;
						document.getElementById('stationsList').appendChild(stationBtn); 
					}
					
					document.addEventListener('click', function(e) {
						if(e.srcElement.nodeName == 'BUTTON' && e.srcElement.id.includes("_")){
							setChannel(e.srcElement.id);
						}
					});
				});

			function setChannel(channel){
				// Switch channel
				fetch('/api', {
					method: 'POST',
					headers: {'Content-Type': 'application/json; charset=utf-8'},
					body: JSON.stringify({
						action: 'pushChannel',
						channel: channel
					}),
					json: true
				});
			};
			
			function powerKey(){
				// Power on/off
				fetch('/api', {
					method: 'POST',
					headers: {'Content-Type': 'application/json; charset=utf-8'},
					body: JSON.stringify({
						action: 'powerKey'
					}),
					json: true
				});
			};	
			
			function escapeKey(){
				// Escape key
				fetch('/api', {
					method: 'POST',
					headers: {'Content-Type': 'application/json; charset=utf-8'},
					body: JSON.stringify({
						action: 'escapeKey'
					}),
					json: true
				});
			};	
			
			function getStatus(){
				fetch('/api/status')
					.then(function(response) {
						return response.json();
					})
					.then(function(status) {
						if(status.setopboxState){
							document.getElementById("stbStatus").innerHTML = 'Setopbox status: ' + status.setopboxState;
						}
					});
			};
			
			setInterval(function(){ getStatus(); }, 1000);
		</script>
	</body>
</html>	